name: 'Pepare integraton test'
description: 'Pretends to prepare for run integration test'
inputs:
  python-version: 
    description: 'Python version'
    required: true
    default: '3.8.7'
  firefox-version: 
    description: 'Firefox version'
    required: true
    default: '92.0'
  poetry-version: 
    description: 'Poetry version'
    required: true
    default: '1.1.8'
  geckodriver-version: 
    description: 'Poetry version'
    required: true
    default: '0.29.1'
runs:
  using: "composite"
  steps: 
      - name: Set up Poetry
        uses: snok/install-poetry@v1.0.0
        with:
          version: ${{ inputs.poetry-version }}
          virtualenvs-create: true
          virtualenvs-in-project: true
    
      - name: Set up firefox
        uses: browser-actions/setup-firefox@latest
        with:
          firefox-version: ${{ inputs.firefox-version }}

      - name: Set up geckodriver
        uses: browser-actions/setup-geckodriver@latest
        with:
          geckodriver-version: ${{ inputs.geckodriver-version }}

      - name: Check version
        run: |
          poetry --version
          firefox --version
          geckodriver --version

      - name: Export paths
        run: |
          echo "/opt/hostedtoolcache/firefox/${{ inputs.firefox-version }}/x64" >> $GITHUB_PATH
          echo "/opt/hostedtoolcache/geckodriver/${{ inputs.geckodriver-version }}/x64" >> $GITHUB_PATH

      - uses: actions/cache@v2
        id: cached-poetry-dependencies
        with:
          path: |
            .venv
          key: venv-python${{ inputs.python-version }}-${{ hashFiles('**/poetry.lock') }}

      - name: Load dependencies
        if: steps.cached-poetry-dependencies.outputs.cache-hit != 'true'
        run: poetry install --no-interaction --no-root
